@model MicroSocialPlatform.Models.ApplicationUser
@using MicroSocialPlatform.Models

@{
    ViewData["Title"] = "My Profile";
    var posts = ViewBag.Posts as List<Post> ?? new();
    bool isMyProfile = ViewBag.IsMyProfile == true;
}

@if (Model.IsDeleted)
{
    <h2>User not found</h2>
    return;
}

<div class="container mt-4">

    <!-- PROFILE SUMMARY (păstrat) -->
    <div class="card mx-auto profile-card" style="max-width: 1000px;">
        <div class="card-body text-center">
            <partial name="_ProfileSummary.cshtml" />
        </div>
    </div>

    <!-- POSTS -->
    <div class="container mt-4 p-0">
        <div class="row justify-content-center">
            <div class="col-12" style="max-width: 1000px;">

                <!-- HEADER: centrat + buton dreapta -->
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <div style="width:160px;"></div>

                    <div class="text-center flex-grow-1">
                        <h4 class="mb-1 posts-title">Posts</h4>
                        <div class="mx-auto posts-underline"></div>
                    </div>

                    <div style="width:160px;" class="text-end">
                        @if (isMyProfile)
                        {
                            <a asp-controller="Posts" asp-action="Create" class="btn btn-primary btn-pill">
                                Create Post
                            </a>
                        }
                    </div>
                </div>

                @if (!posts.Any())
                {
                    <div class="empty-box">
                        <div class="empty-icon">✦</div>
                        <div class="empty-title">No posts yet</div>
                        <div class="empty-text">Create your first post to share something with others.</div>
                    </div>
                }
                else
                {
                    <div class="row justify-content-center">
                        <div class="col-12 col-md-10 col-lg-8">

                            @foreach (var p in posts)
                            {
                                var fullName = ((p.User?.FirstName ?? "") + " " + (p.User?.LastName ?? "")).Trim();
                                var displayName = string.IsNullOrWhiteSpace(fullName)
                                ? (p.User?.UserName ?? "Unknown")
                                : fullName;

                                var profileImg = p.User?.ProfileImagePath;
                                bool hasProfileImg =
                                !string.IsNullOrWhiteSpace(profileImg) &&
                                profileImg != "/images/profiles/default-profile.png";

                                var initials = string.Join("",
                                displayName.Split(' ', StringSplitOptions.RemoveEmptyEntries)
                                .Select(s => s[0]).Take(2)).ToUpper();

                                <div class="post-card mb-4">
                                    <div class="post-card-body">

                                        <!-- Header: avatar + nume + data -->
                                        <div class="d-flex justify-content-between align-items-start gap-2">
                                            <div class="d-flex align-items-start gap-3">
                                                <a asp-controller="Profile"
                                                   asp-action="Show"
                                                   asp-route-id="@p.UserId"
                                                   class="avatar-link">

                                                    @if (hasProfileImg)
                                                    {
                                                        <img src="@profileImg" class="avatar-img" alt="Profile photo" />
                                                    }
                                                    else
                                                    {
                                                        <div class="avatar-circle">@initials</div>
                                                    }
                                                </a>

                                                <div>
                                                    <a class="post-author profile-link"
                                                       asp-controller="Profile"
                                                       asp-action="Show"
                                                       asp-route-id="@p.UserId">
                                                        @displayName
                                                    </a>

                                                    <div class="post-meta">
                                                        @p.CreatedAt.ToLocalTime()
                                                        @if (p.UpdatedAt != null)
                                                        {
                                                            <span> • edited</span>
                                                        }
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="d-flex align-items-center">
                                                <a asp-controller="Posts"
                                                   asp-action="Show"
                                                   asp-route-id="@p.Id"
                                                   class="btn btn-sm btn-outline-success btn-pill">
                                                    View
                                                </a>
                                            </div>
                                        </div>

                                        <!-- Content -->
                                        @if (!string.IsNullOrEmpty(p.Content))
                                        {
                                            <div class="post-content mt-3">@p.Content</div>
                                        }

                                        <!-- Media -->
                                        @if (!string.IsNullOrEmpty(p.ImagePath))
                                        {
                                            <div class="media-wrap mt-3">
                                                <img src="@p.ImagePath" class="media-img" />
                                            </div>
                                        }

                                        @if (!string.IsNullOrEmpty(p.VideoPath))
                                        {
                                            <div class="media-wrap mt-3">
                                                <video controls class="media-video">
                                                    <source src="@p.VideoPath" />
                                                </video>
                                            </div>
                                        }

                                    </div>
                                </div>
                            }

                        </div>
                    </div>
                }

            </div>
        </div>
    </div>

</div>

<style>
    body {
        background: #f6efe3;
    }

    .profile-card {
        border-radius: 18px;
        background: rgba(255,255,255,.92);
        border: 1px solid rgba(0,0,0,.06);
        box-shadow: 0 10px 26px rgba(0,0,0,.06);
    }

    .posts-title {
        font-weight: 800;
        letter-spacing: .2px;
    }

    .posts-underline {
        height: 3px;
        width: 70px;
        border-radius: 999px;
        background: rgba(13,110,253,.18);
    }

    .profile-link {
        text-decoration: none;
        color: inherit;
    }

        .profile-link:hover {
            text-decoration: underline;
        }

    .avatar-link {
        display: inline-flex;
        text-decoration: none;
    }

    .avatar-circle {
        width: 42px;
        height: 42px;
        border-radius: 999px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        color: #fff;
        background: linear-gradient(135deg, rgba(13,110,253,.95), rgba(111,66,193,.85));
        box-shadow: 0 10px 20px rgba(13,110,253,.18);
        flex: 0 0 auto;
    }

    .avatar-img {
        width: 42px;
        height: 42px;
        border-radius: 999px;
        object-fit: cover;
        border: 2px solid rgba(255,255,255,.9);
        box-shadow: 0 10px 20px rgba(0,0,0,.10);
        background: #fff;
        flex: 0 0 auto;
    }

    .post-card {
        border-radius: 16px;
        background: rgba(255,255,255,.92);
        border: 1px solid rgba(0,0,0,.06);
        box-shadow: 0 10px 26px rgba(0,0,0,.06);
        transition: transform .15s ease, box-shadow .15s ease;
    }

        .post-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 14px 34px rgba(0,0,0,.08);
        }

    .post-card-body {
        padding: 16px;
    }

    .post-author {
        font-weight: 800;
        line-height: 1.1;
        display: inline-block;
    }

    .post-meta {
        color: #6c757d;
        font-size: .88rem;
        margin-top: 2px;
    }

    .post-content {
        white-space: pre-wrap;
        color: #111827;
        font-size: 1rem;
        line-height: 1.45;
    }

    .media-wrap {
        border-radius: 14px;
        overflow: hidden;
        border: 1px solid rgba(0,0,0,.06);
        background: #fff;
    }

    .media-img {
        width: 100%;
        display: block;
        object-fit: cover;
    }

    .media-video {
        width: 100%;
        display: block;
    }

    .empty-box {
        border-radius: 16px;
        background: rgba(255,255,255,.85);
        border: 1px dashed rgba(0,0,0,.12);
        padding: 18px;
        text-align: center;
        box-shadow: 0 10px 22px rgba(0,0,0,.05);
    }

    .empty-icon {
        font-size: 1.4rem;
        opacity: .9;
        margin-bottom: 6px;
    }

    .empty-title {
        font-weight: 800;
        margin-bottom: 2px;
    }

    .empty-text {
        color: #6c757d;
    }

    .btn-pill {
        border-radius: 999px !important;
        font-weight: 700;
        padding: .45rem .9rem;
        transition: transform .12s ease, box-shadow .12s ease;
    }

        .btn-pill:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 18px rgba(0,0,0,.06);
        }
</style>
